<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Add Billing Data</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>

<nav>
  <a href="index.html">Dashboard</a>
  <a href="service.html?service=gcp">GCP</a>
  <a href="service.html?service=aws">AWS</a>
  <a href="service.html?service=hetzner">Hetzner</a>
  <a href="service.html?service=jira">Jira</a>
  <a href="service.html?service=bitbucket">Bitbucket</a>
  <a href="add-billing.html" class="active">Add Billing</a>
  <a href="instance.html">Instance</a>
</nav>

<div class="app-container">

  <div class="sidebar">
    <button onclick="history.back()">← Back</button>
  </div>

  <div class="main">

    <h1>Add Billing Data</h1>
    <p style="color: #94a3b8; font-size: 16px; margin-bottom: 32px;">
      Enter billing information for your cloud services
    </p>

    <div class="card">
      <label>Entry Type</label>
      <select id="type">
        <option value="daily">Daily Entry</option>
        <option value="monthly">Monthly Entry</option>
      </select>

      <label>Service Name</label>
      <input id="service" placeholder="e.g., gcp, aws, hetzner" />

      <label>Resource Type</label>
      <input id="resourceType" placeholder="e.g., compute, storage, network" />

      <label>SKU</label>
      <input id="sku" placeholder="Stock Keeping Unit identifier" />

      <label>Usage Amount</label>
      <input id="usage" type="number" step="0.01" placeholder="Quantity used" />

      <label>Price (₹)</label>
      <input id="price" type="number" step="0.01" placeholder="Original price" />

      <label>Discount Percentage (%)</label>
      <input id="discount" type="number" step="0.01" placeholder="Discount percentage" />

      <label id="dateLabel">Date</label>
      <input id="date" type="date" />

      <label id="monthLabel" style="display:none">Month</label>
      <input id="month" type="month" style="display:none" />

      <button onclick="submitData()" style="width: 100%; margin-top: 16px;">
        Add Billing Data
      </button>
    </div>

  </div>
</div>

<script>
const typeEl = document.getElementById("type");
const dateEl = document.getElementById("date");
const monthEl = document.getElementById("month");
const dateLabel = document.getElementById("dateLabel");
const monthLabel = document.getElementById("monthLabel");

typeEl.onchange = () => {
  if (typeEl.value === "daily") {
    dateEl.style.display = "block";
    dateLabel.style.display = "block";
    monthEl.style.display = "none";
    monthLabel.style.display = "none";
  } else {
    dateEl.style.display = "none";
    dateLabel.style.display = "none";
    monthEl.style.display = "block";
    monthLabel.style.display = "block";
  }
};

async function submitData() {
  const serviceVal = document.getElementById("service").value;
  const resourceTypeVal = document.getElementById("resourceType").value;
  const skuVal = document.getElementById("sku").value;
  const usageVal = document.getElementById("usage").value;
  const priceVal = document.getElementById("price").value;
  const discountVal = document.getElementById("discount").value;

  if (!serviceVal || !resourceTypeVal || !skuVal || !usageVal || !priceVal) {
    alert("Please fill in all required fields");
    return;
  }

  try {
    const response = await fetch("/api/billing/add", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        type: typeEl.value,
        service: serviceVal,
        resourceType: resourceTypeVal,
        sku: skuVal,
        usage: +usageVal,
        price: +priceVal,
        discountPercent: +discountVal || 0,
        date: dateEl.value,
        month: monthEl.value
      })
    });

    if (response.ok) {
      alert("Billing data added successfully!");

      document.getElementById("service").value = "";
      document.getElementById("resourceType").value = "";
      document.getElementById("sku").value = "";
      document.getElementById("usage").value = "";
      document.getElementById("price").value = "";
      document.getElementById("discount").value = "";
      dateEl.value = "";
      monthEl.value = "";
    } else {
      alert("Failed to add billing data");
    }
  } catch (error) {
    alert("Error: " + error.message);
  }
}
</script>

</body>
</html>
